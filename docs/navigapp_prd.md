# PRD: Навигапп - Telegram Mini App для навигации

## 1. Обзор продукта

### 1.1 Видение
Навигапп — это Telegram миниаппликация, которая позволяет создавать структурированную навигацию внутри каналов, групп и чатов через интерактивные карточки и меню.

### 1.2 Миссия
Упростить навигацию по контенту в Telegram для создателей курсов, владельцев каналов и команд, предоставив интуитивный инструмент для организации материалов.

### 1.3 Целевая аудитория

**Первичная аудитория:**
1. **Мастера/эксперты** — создатели онлайн-курсов в закрытых Telegram каналах
2. **Владельцы каналов/блогов** — создатели контента с большим объемом полезных материалов
3. **Команды компаний** — внутренние чаты с базой знаний и документации

**Вторичная аудитория:**
- Подписчики каналов и участники групп, использующие навигацию

## 2. Функциональные требования

### 2.1 Сравнение версий продукта

| Функция | Бесплатная версия | Pro версия |
|---------|-------------------|------------|
| **Количество страниц** | 1 страница | Неограниченно |
| **Количество карточек на странице** | До 8 карточек | Неограниченно |
| **Типы блоков** | Только вертикальный список | Все типы: вертикальный список, сетка 2 колонки, горизонтальный скролл, лента больших карточек |
| **Внутренние страницы** | ❌ | ✅ |
| **Кастомизация карточек** | Базовая (иконка, текст, описание) | Полная (иконки, фоновые изображения) |
| **Аналитика** | Базовая (просмотры) | Расширенная (клики, конверсии) |
| **Поддержка** | Самообслуживание | Приоритетная поддержка |

### 2.2 Основные функции

#### 2.2.1 Создание и управление страницами
- **Мастер создания страницы** — пошаговый процесс с прогресс-баром
- **Редактор контента** — добавление/удаление/изменение карточек
- **Предварительный просмотр** — отображение страницы перед публикацией
- **Управление несколькими страницами** (Pro)

#### 2.2.2 Типы блоков и карточек

**Вертикальный список (Free + Pro):**
- Иконка + заголовок + описание
- Без фоновых изображений

**Сетка 2 колонки (Pro):**
- Квадратные карточки
- Текст в 3 строки + описание
- Фоновое изображение

**Горизонтальный скролл (Pro):**
- Компактные карточки
- Иконка + текст + описание

**Лента больших карточек (Pro):**
- Крупные карточки с фоном
- Заголовок + описание + фоновое изображение

#### 2.2.3 Система навигации
- **Внешние ссылки** — на Telegram посты, каналы, группы
- **Внутренние страницы** — многоуровневая навигация (Pro)
- **Хлебные крошки** — для внутренней навигации (Pro)

## 3. Пользовательские сценарии

### 3.1 Первая сессия владельца

**Онбординг:**
1. Экран ценности приложения → "Продолжить"
2. Инструкция заполнения → "Продолжить" 
3. Инструкция публикации → "Создать свою страничку"

**Создание страницы:**
1. **Шаг 1/3:** Ввод названия страницы
2. **Шаг 2/3:** Добавление карточек (до 8 штук)
   - Название карточки + ссылка
   - Кнопка "Добавить еще карточку"
3. **Шаг 3/3:** Предварительный просмотр
   - Кнопка "Редактировать" (вверху)
   - Кнопка "Опубликовать" (внизу, акцентная)

**Публикация:**
- Генерация ссылки на страницу
- Кнопка "Скопировать и продолжить"
- Ссылка на инструкцию размещения

### 3.2 Вторая сессия владельца

**Интерфейс созданной страницы:**
- Отображение страницы
- Кнопки вверху:
  - "Настройки профиля"
  - "Редактировать"
- Внизу: "Страничка создана в приложении Навигапп" + кнопка "Создать страницу"

**Настройки профиля:**
- Список созданных страниц
- Кнопка "Создать страничку"
- Имя профиля
- Информация о приложении
- Ссылка на пользовательское соглашение
- Контакт разработчика: @kirillshmonin

### 3.3 Сессия читателя

**Просмотр страницы:**
- Переход по ссылке из поста/закрепленного сообщения
- Просмотр карточек, созданных владельцем
- Переходы по ссылкам при клике на карточки

**Доступные действия:**
- Кнопка профиля → настройки читателя
- Возможность создать собственную страницу

## 4. Техническая архитектура

### 4.1 Общие требования
- **Платформа:** Telegram Mini Apps
- **Архитектура:** Разделение фронтенда и бэкенда
- **База данных:** Supabase
- **Хостинг:** Vercel
- **Система версионирования:** GitHub
- **Тестирование:** Автоматизированное через Claude Code

### 4.2 Фронтенд спецификация

**Технологический стек:**
- **Framework:** React 18+ с TypeScript
- **Styling:** Tailwind CSS + CSS Modules
- **State Management:** Zustand
- **Telegram Integration:** @twa-dev/sdk
- **Build Tool:** Vite
- **Deployment:** Vercel

**Ключевые компоненты:**
```typescript
// Основные компоненты
- App.tsx // Главный компонент приложения
- Router.tsx // Роутинг между экранами
- Layout.tsx // Общий лейаут с навигацией

// Экраны
- OnboardingScreen.tsx // Онбординг новых пользователей
- PageBuilderScreen.tsx // Мастер создания страниц
- PageViewScreen.tsx // Просмотр созданной страницы
- ProfileScreen.tsx // Настройки профиля
- EditPageScreen.tsx // Редактирование страницы

// Компоненты карточек
- VerticalListCard.tsx // Вертикальный список
- GridCard.tsx // Сетка 2 колонки (Pro)
- HorizontalScrollCard.tsx // Горизонтальный скролл (Pro)
- FeedCard.tsx // Лента больших карточек (Pro)

// UI компоненты
- Button.tsx // Кнопки с хаптик фидбеком
- ProgressBar.tsx // Прогресс-бар для мастера
- Modal.tsx // Модальные окна
- Toast.tsx // Уведомления
```

**UI/UX требования:**
- Поддержка тем Telegram (light/dark mode)
- Хаптик вибрации для всех интерактивных элементов
- Нативные элементы Telegram Mini Apps
- Адаптивный дизайн для мобильных устройств
- Анимации переходов между экранами

### 4.3 Бэкенд спецификация

**Технологический стек:**
- **Runtime:** Node.js 20+
- **Framework:** Fastify
- **Database:** Supabase (PostgreSQL)
- **Authentication:** Supabase Auth + Telegram WebApp Auth
- **Payments:** T-Bank API
- **File Storage:** Supabase Storage
- **Deployment:** Supabase Edge Functions

**API Endpoints:**
```typescript
// Аутентификация
POST /auth/telegram // Вход через Telegram
POST /auth/refresh // Обновление токена

// Управление пользователями
GET /users/profile // Получение профиля
PUT /users/profile // Обновление профиля
GET /users/subscription // Статус подписки

// Управление страницами
GET /pages // Список страниц пользователя
POST /pages // Создание новой страницы
GET /pages/:id // Получение страницы
PUT /pages/:id // Обновление страницы
DELETE /pages/:id // Удаление страницы
POST /pages/:id/publish // Публикация страницы

// Аналитика
GET /analytics/page/:id // Статистика страницы
POST /analytics/view // Регистрация просмотра
POST /analytics/click // Регистрация клика

// Платежи
POST /payments/subscribe // Создание подписки
POST /payments/trial // Активация пробного периода
GET /payments/status // Статус платежа
POST /webhooks/tbank // Webhook от T-Bank
```

**Модель данных:**
```sql
-- Пользователи
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  telegram_id BIGINT UNIQUE NOT NULL,
  username VARCHAR(255),
  first_name VARCHAR(255),
  subscription_type VARCHAR(50) DEFAULT 'free',
  subscription_expires_at TIMESTAMP,
  trial_used BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Страницы
CREATE TABLE pages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  title VARCHAR(255) NOT NULL,
  description TEXT,
  slug VARCHAR(255) UNIQUE NOT NULL,
  is_published BOOLEAN DEFAULT false,
  parent_page_id UUID REFERENCES pages(id), -- Для внутренних страниц
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Блоки на странице
CREATE TABLE page_blocks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  page_id UUID REFERENCES pages(id) ON DELETE CASCADE,
  type VARCHAR(50) NOT NULL, -- 'vertical_list', 'grid', 'horizontal_scroll', 'feed'
  title VARCHAR(255),
  description TEXT,
  position INTEGER NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Карточки в блоке
CREATE TABLE block_cards (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  block_id UUID REFERENCES page_blocks(id) ON DELETE CASCADE,
  title VARCHAR(255) NOT NULL,
  description TEXT,
  icon_url VARCHAR(500),
  background_image_url VARCHAR(500),
  link_url VARCHAR(500),
  link_type VARCHAR(50) DEFAULT 'external', -- 'external', 'internal'
  internal_page_id UUID REFERENCES pages(id),
  position INTEGER NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Аналитика
CREATE TABLE analytics_events (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  page_id UUID REFERENCES pages(id) ON DELETE CASCADE,
  event_type VARCHAR(50) NOT NULL, -- 'view', 'click'
  card_id UUID REFERENCES block_cards(id) ON DELETE SET NULL,
  user_telegram_id BIGINT,
  ip_address INET,
  user_agent TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Подписки
CREATE TABLE subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  type VARCHAR(50) NOT NULL, -- 'trial', 'monthly', 'yearly'
  status VARCHAR(50) NOT NULL, -- 'active', 'cancelled', 'expired'
  tbank_subscription_id VARCHAR(255),
  started_at TIMESTAMP NOT NULL,
  expires_at TIMESTAMP NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### 4.4 Интеграции

**Telegram Mini Apps:**
- Аутентификация через Telegram WebApp
- Хаптик фидбек через Telegram API
- Темы приложения синхронизированы с Telegram
- Кнопки "Назад" и навигация через Telegram

**T-Bank Платежи:**
- Рекуррентные платежи для подписок
- Пробный период 7 дней за 1 рубль
- Webhook для обработки статусов платежей
- Автоматическое продление подписки

## 5. Монетизация

### 5.1 Модель подписки
- **Бесплатная версия:** Ограниченный функционал
- **Pro подписка:** 299₽/месяц или 2990₽/год
- **Пробный период:** 7 дней за 1₽

### 5.2 Конверсионная воронка
1. Регистрация → создание первой страницы (Free)
2. Достижение лимитов → предложение Pro
3. Пробный период → конверсия в платную подписку

## 6. Этапы разработки

### 6.1 MVP (4-6 недель)
**Фронтенд:**
- Базовый онбординг
- Создание страниц (Free версия)
- Вертикальные списки карточек
- Просмотр страниц

**Бэкенд:**
- Аутентификация через Telegram
- CRUD операции для страниц и карточек
- Базовая аналитика
- Деплой на Vercel + Supabase

### 6.2 Платная версия (3-4 недели)
**Фронтенд:**
- Дополнительные типы блоков
- Редактор с кастомизацией
- Внутренние страницы
- Управление подпиской

**Бэкенд:**
- Интеграция T-Bank API
- Система подписок и биллинга
- Ограничения по тарифам
- Расширенная аналитика

### 6.3 Оптимизация (2-3 недели)
- A/B тесты конверсий
- Улучшение UX на основе метрик
- Оптимизация производительности
- Система поддержки пользователей

## 7. Потенциальные риски и решения

### 7.1 Технические риски
**Риск:** Ограничения Telegram Mini Apps
**Решение:** Тщательное изучение документации, создание fallback решений

**Риск:** Проблемы с платежами T-Bank
**Решение:** Подробная обработка ошибок, альтернативные способы оплаты

### 7.2 Продуктовые риски
**Риск:** Низкая конверсия Free → Pro
**Решение:** A/B тестирование ограничений, улучшение onboarding

**Риск:** Слабая retention
**Решение:** Система уведомлений, улучшение ценностного предложения

## 8. Метрики успеха

### 8.1 Ключевые метрики
- **DAU/MAU:** Активные пользователи
- **Конверсия регистрации:** % завершивших онбординг
- **Конверсия Free → Pro:** % перешедших на платную версию
- **Retention:** Возвращение пользователей через 1, 7, 30 дней
- **ARPU:** Средний доход с пользователя

### 8.2 Целевые показатели (6 месяцев)
- 10,000 зарегистрированных пользователей
- 1,000 активных создателей страниц
- 5% конверсия в Pro подписку
- 70% retention на 7 дней

## 9. Контакты и поддержка

**Разработчик:** @kirillshmonin
**Техническая поддержка:** Через Telegram бот
**Документация:** Встроенные инструкции в приложении
**Обратная связь:** Форма в настройках профиля

---

*Этот PRD является живым документом и будет обновляться по мере развития продукта и получения обратной связи от пользователей.*